{% extends "layout.html" %}

{% block content %}
<style>
    /* --- HERO SECTION --- */
    .hero-badge { background: rgba(99, 102, 241, 0.1); color: #818cf8; border: 1px solid rgba(99, 102, 241, 0.2); padding: 6px 16px; border-radius: 50px; font-size: 0.8rem; font-weight: 600; letter-spacing: 1px; }
    
    .gradient-text { background: linear-gradient(135deg, #fff 0%, #94a3b8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .gradient-highlight { background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    /* --- TABS --- */
    .platform-tabs { display: inline-flex; background: rgba(255,255,255,0.03); padding: 5px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
    .tab-btn { background: transparent; border: none; color: #94a3b8; padding: 10px 25px; border-radius: 40px; font-weight: 500; transition: all 0.3s; }
    .tab-btn.active { background: #1e293b; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .tab-btn:hover { color: white; }

    /* --- INPUT BOX --- */
    .search-container { max-width: 800px; margin: 0 auto; position: relative; }
    .main-input { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 25px 180px 25px 60px; border-radius: 20px; width: 100%; font-size: 1.1rem; outline: none; transition: 0.3s; backdrop-filter: blur(5px); }
    .main-input:focus { border-color: #818cf8; background: rgba(30, 41, 59, 0.8); box-shadow: 0 0 0 4px rgba(129, 140, 248, 0.1); }
    
    .input-icon { position: absolute; left: 25px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 1.2rem; }
    
    .action-group { position: absolute; right: 10px; top: 10px; bottom: 10px; display: flex; gap: 10px; }
    .btn-paste { background: rgba(255,255,255,0.05); color: #94a3b8; border: none; padding: 0 20px; border-radius: 12px; font-weight: 500; }
    .btn-start { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; border: none; padding: 0 30px; border-radius: 12px; font-weight: 600; font-size: 1.1rem; transition: 0.3s; }
    .btn-start:hover { opacity: 0.9; transform: translateY(-1px); }

    /* --- CARDS (Features & Steps) --- */
    .feature-card { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255,255,255,0.05); padding: 30px; border-radius: 24px; height: 100%; transition: 0.3s; }
    .feature-card:hover { background: rgba(30, 41, 59, 0.6); transform: translateY(-5px); border-color: rgba(255,255,255,0.1); }
    .icon-box { width: 50px; height: 50px; background: rgba(129, 140, 248, 0.1); color: #818cf8; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 20px; }

    .step-circle { width: 60px; height: 60px; background: #1e293b; border: 2px solid rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #a855f7; margin: 0 auto 20px; position: relative; z-index: 2; }
    .step-line { position: absolute; top: 30px; left: 0; width: 100%; height: 2px; background: rgba(255,255,255,0.1); z-index: 1; display: none; }
    @media(min-width: 768px) { .step-line { display: block; } }

    /* Result Area */
    #result-area { display: none; max-width: 600px; margin: 40px auto; background: #1e293b; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
</style>

<div class="container text-center py-5">
    <span class="hero-badge mb-4 d-inline-block">✨ AI-POWERED MEDIA EXTRACTION</span>
    <h1 class="display-3 fw-bold mb-3 gradient-text">Download Social Media</h1>
    <h1 class="display-3 fw-bold mb-4 gradient-highlight">Without Watermark</h1>
    <p class="text-secondary lead mb-5 mx-auto" style="max-width: 600px;">
        Professional-grade tool to save TikToks, Instagram Reels, and YouTube Shorts in pristine quality. No limits, no ads.
    </p>

    <div class="platform-tabs">
        <button class="tab-btn active" onclick="setPlatform('TikTok')"><i class="bi bi-tiktok"></i> TikTok</button>
        <button class="tab-btn" onclick="setPlatform('Instagram')"><i class="bi bi-instagram"></i> Instagram</button>
        <button class="tab-btn" onclick="setPlatform('YouTube')"><i class="bi bi-youtube"></i> YouTube</button>
        <button class="tab-btn" onclick="setPlatform('Facebook')"><i class="bi bi-facebook"></i> Facebook</button>
    </div>

    <div class="search-container">
        <i class="bi bi-link-45deg input-icon"></i>
        <input type="text" id="url-input" class="main-input" placeholder="Paste TikTok video link...">
        <div class="action-group">
            <button class="btn-paste" onclick="pasteLink()"><i class="bi bi-clipboard"></i> Paste</button>
            <button class="btn-start" id="btn-action" onclick="downloadMedia()">Start <i class="bi bi-chevron-right"></i></button>
        </div>
    </div>
    
    <div id="loading" class="mt-5" style="display: none;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <p class="text-secondary mt-3">Fetching video data...</p>
    </div>

    <div id="result-area">
        <img id="thumb" src="" class="w-100" style="max-height: 350px; object-fit: cover;">
        <div class="p-4 text-start">
            <h5 id="title" class="text-white mb-2 text-truncate">Video Title</h5>
            <p class="text-secondary small mb-4">Quality: HD • Source: <span id="source-tag">Unknown</span></p>
            <a id="dl-link" href="#" class="btn btn-primary w-100 py-3 rounded-3 fw-bold">Download Video <i class="bi bi-download ms-2"></i></a>
        </div>
    </div>
</div>

<div id="how-it-works" class="container py-5 mt-5 position-relative">
    <div class="text-center mb-5">
        <h2 class="fw-bold mb-3">How It Works</h2>
        <p class="text-secondary">Get your favorite videos in three simple steps.</p>
    </div>
    
    <div class="row text-center position-relative">
        <div class="step-line"></div>
        <div class="col-md-4 mb-4">
            <div class="step-circle"><i class="bi bi-copy"></i></div>
            <h5 class="fw-bold mt-4">1. Copy the Link</h5>
            <p class="text-secondary small">Find the video you want and copy its URL.</p>
        </div>
        <div class="col-md-4 mb-4">
            <div class="step-circle"><i class="bi bi-magic"></i></div>
            <h5 class="fw-bold mt-4">2. Paste & Process</h5>
            <p class="text-secondary small">Paste the link into the box above. AI does the rest.</p>
        </div>
        <div class="col-md-4 mb-4">
            <div class="step-circle"><i class="bi bi-download"></i></div>
            <h5 class="fw-bold mt-4">3. Download File</h5>
            <p class="text-secondary small">Save the watermark-free video instantly.</p>
        </div>
    </div>
</div>

<div id="features" class="container py-5 mb-5">
    <div class="text-center mb-5">
        <h2 class="fw-bold mb-3">Why use StreamSnap?</h2>
        <p class="text-secondary">The most reliable tool for offline viewing.</p>
    </div>

    <div class="row g-4">
        <div class="col-md-3 col-6">
            <div class="feature-card">
                <div class="icon-box"><i class="bi bi-lightning-charge-fill"></i></div>
                <h5 class="fw-bold mb-2">Lightning Fast</h5>
                <p class="text-secondary small mb-0">AI processes links in milliseconds.</p>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="feature-card">
                <div class="icon-box"><i class="bi bi-shield-check-fill"></i></div>
                <h5 class="fw-bold mb-2">100% Secure</h5>
                <p class="text-secondary small mb-0">No history stored. Completely private.</p>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="feature-card">
                <div class="icon-box"><i class="bi bi-droplet-half"></i></div>
                <h5 class="fw-bold mb-2">No Watermarks</h5>
                <p class="text-secondary small mb-0">Pristine quality without logos.</p>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="feature-card">
                <div class="icon-box"><i class="bi bi-phone-fill"></i></div>
                <h5 class="fw-bold mb-2">Mobile Ready</h5>
                <p class="text-secondary small mb-0">Optimized for iPhone & Android.</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Tab Switching Logic (Visual)
    function setPlatform(platform) {
        document.getElementById('url-input').placeholder = `Paste ${platform} video link...`;
        
        // Buttons active state change
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.closest('button').classList.add('active');
    }

    // Paste Button Logic
    async function pasteLink() {
        try {
            const text = await navigator.clipboard.readText();
            document.getElementById('url-input').value = text;
        } catch (err) {
            alert('Failed to read clipboard');
        }
    }

    // Download Logic (Backend Connect)
    async function downloadMedia() {
        const input = document.getElementById('url-input');
        const btn = document.getElementById('btn-action');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result-area');

        if (!input.value) { alert("Please paste a link!"); return; }

        // UI Reset
        btn.disabled = true; btn.innerHTML = '<i class="bi bi-hourglass-split"></i>';
        loading.style.display = 'block'; result.style.display = 'none';

        try {
            const response = await fetch('/get-video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: input.value, type: 'video' })
            });
            const data = await response.json();
            
            loading.style.display = 'none'; btn.disabled = false; btn.innerHTML = 'Start <i class="bi bi-chevron-right"></i>';

            if (data.error) { alert("Error: " + data.error); } 
            else {
                document.getElementById('thumb').src = data.thumbnail;
                document.getElementById('title').innerText = data.title;
                document.getElementById('source-tag').innerText = data.platform;
                document.getElementById('dl-link').href = data.download_url;
                result.style.display = 'block';
                // Scroll to result
                result.scrollIntoView({ behavior: 'smooth' });
            }
        } catch (e) { 
            alert("Error connecting to server"); 
            loading.style.display = 'none'; 
            btn.disabled = false; 
            btn.innerHTML = 'Start <i class="bi bi-chevron-right"></i>';
        }
    }
</script>
{% endblock %}